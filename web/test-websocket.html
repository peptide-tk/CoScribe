<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CoScribe WebSocket Test</title>
  </head>
  <body>
    <div class="container">
      <h1>CoScribe WebSocket Test</h1>

      <div id="status" class="status disconnected">Status: Disconnected</div>

      <div class="input-group">
        <button id="connectBtn" onclick="connect()">Connect</button>
        <button id="disconnectBtn" onclick="disconnect()" disabled>
          Disconnect
        </button>
      </div>

      <div class="message-box" id="messages"></div>

      <div class="input-group">
        <input
          type="text"
          id="messageInput"
          placeholder="Enter message..."
          onkeypress="handleKeyPress(event)"
        />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <script>
      let ws = null;
      const messages = document.getElementById("messages");
      const status = document.getElementById("status");
      const connectBtn = document.getElementById("connectBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");

      function connect() {
        if (ws) {
          ws.close();
        }

        const wsUrl = "ws://localhost:8080/ws/echo";
        ws = new WebSocket(wsUrl);

        ws.onopen = function (event) {
          addMessage("Connected to server");
          updateStatus("Connected", true);
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
        };

        ws.onmessage = function (event) {
          addMessage("Received: " + event.data);
        };

        ws.onclose = function (event) {
          addMessage("Connection closed");
          updateStatus("Disconnected", false);
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
        };

        ws.onerror = function (error) {
          addMessage("Error: " + error);
          updateStatus("Error", false);
        };
      }

      function disconnect() {
        if (ws) {
          ws.close();
        }
      }

      function sendMessage() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();

        if (message && ws && ws.readyState === WebSocket.OPEN) {
          ws.send(message);
          addMessage("Sent: " + message);
          input.value = "";
        } else {
          addMessage("Cannot send message: Not connected");
        }
      }

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      function addMessage(message) {
        const div = document.createElement("div");
        div.textContent = new Date().toLocaleTimeString() + " - " + message;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      function updateStatus(statusText, connected) {
        status.textContent = "Status: " + statusText;
        status.className =
          "status " + (connected ? "connected" : "disconnected");
      }
    </script>
  </body>
</html>
